<html>
  <head>
    <!-- Problem 61 -->
    <title>Cyclical figurate numbers</title>
    <link rel="stylesheet" href="common.css"/>
    <script src="common.js"></script>
    <script type="text/javascript">
//    	var pentagonal = (n) => parseInt(n * (3 * n - 1) / 2);
        
    	const TRIANGLE = 0;
    	const SQUARE = 1;
    	const PENTAGONAL = 2;
    	const HEXAGONAL = 3;
    	const HEPTAGONAL = 4;
    	const OCTAGONAL = 5;
    	
    	var fs = [
    		(n) => parseInt(n * (n + 1) / 2),      //TRIANGLE
    		(n) => n * n,                          //SQUARE
    		(n) => parseInt(n * (3 * n - 1) / 2),  //PENTAGONAL
    		(n) => n * (2 * n - 1),                //HEXAGONAL
    		(n) => parseInt(n * (5 * n - 3) / 2),  //HEPTAGONAL
    		(n) => n * (3 * n - 2)                 //OCTAGONAL
    	];
    	var sets = [new Set(), new Set(), new Set(), new Set(), new Set(), new Set()];
        
        function initSet(set, f, minNumberLength, maxNumberLength) {
        	for (var n = 1; ; n++) {
        		var v = f(n);
        		var s = "" + v;
        		if (s.length > maxNumberLength) {
        			break;
        		} else if (s.length >= minNumberLength) {
        			set.add(v)
        		}
        	}
        }
        
        var numberLength = 6;
        var halfNumberLength = 3;

        function init() {
        	for (var i = TRIANGLE; i <= OCTAGONAL; i++) {
            	initSet(sets[i], fs[i], numberLength, numberLength);
        	};
        }
        
        init();
        
        function findInASet(val, usedSets) {
        	var result = [];
        	for (var i = TRIANGLE; i <= OCTAGONAL; i++) {
        		if (!usedSets.has(i) && sets[i].has(val)) {
					result.push(i);
				}
        	}
        	return result;
        }
        
        function solve(list, usedSets) {
        	var first = list[0];
        	var prefix = ("" + list[list.length - 1]).substring(halfNumberLength);
        	
        	if (list.length == 5) {
        		var val = parseInt(prefix + ("" + first).substring(0, halfNumberLength));

        		var ways = findInASet(val, usedSets);
        		if (ways.length > 0) {
        			list.push(val);
        			return list;
        		} else {
        			return null;
        		}
        	}
        	var ib = 1;
        	for (var q = 1; q < halfNumberLength; q++) ib *= 10;
        	var ie = ib * 10;
        	
        	for (var i = ib; i < ie; i++) {
        		if (prefix == "" + i) continue;
        		var val = parseInt(prefix + i);
        		if (list.includes(val)) continue;
        		var ways = findInASet(val, usedSets);
        		if (ways.length == 0) continue;
        		list.push(val);
        		for (var j = 0; j < ways.length; j++) {
        			usedSets.add(ways[j]);
	    			var res = solve(list, usedSets);
    				if (res != null) {
    					return res;
    				}
            		usedSets.delete(ways[j]);
        		}
       			list.pop(val);
        	}
        	return null;
        }

    	function solveAndOut(targetId) {
    		var result = "";
    		var startSet = SQUARE;
    		for (var it = sets[startSet].values(), val = it.next().value; val != null; val=it.next().value) {
    			var list = [];
    			list.push(val);
    			var usedSets = new Set();
    			usedSets.add(startSet);
    			var res = solve(list, usedSets);    			
    			if (list.length == 6) {
    				result = "Result = " + list.reduce((a, b) => a + b) + " = " + list.join(" + ");
    				break;
    			}
    		}
    		common.out(result, targetId);
    	}
    </script>  
  </head>
  
  <body onload="common.addProblemHeader('problem61Title', 61);">
    <div id="problem61Title"></div>
    <div class="problemStatement">
      <p>Triangle, square, pentagonal, hexagonal, heptagonal, and octagonal numbers are all figurate (polygonal) numbers and are generated by the following formulae:</p>
      <table>
        <tr><td>Triangle</td><td><i>P<sub>3,n</sub>=n(n+1)/2</i></td><td>1, 3, 6, 10, 15, ...</td></tr>
        <tr><td>Square</td><td><i>P<sub>4,n</sub>=n<sup>2</sup></i></td><td>1, 4, 9, 16, 25, ...</td></tr>
        <tr><td>Pentagonal</td><td><i>P<sub>5,n</sub>=n(3n-1)/2</i></td><td>1, 5, 12, 22, 35, ...</td></tr>
        <tr><td>Hexagonal</td><td><i>P<sub>6,n</sub>=n(2n-1)</i></td><td>1, 6, 15, 28, 45, ...</td></tr>
        <tr><td>Heptagonal</td><td><i>P<sub>7,n</sub>=n(5n-3)/2</i></td><td>1, 7, 18, 34, 55, ...</td></tr>
        <tr><td>Octagonal</td><td><i>P<sub>8,n</sub>=n(3n-2)</i></td><td>1, 8, 21, 40, 65, ...</td></tr>
      </table>
      <p>The ordered set of three 4-digit numbers: 8128, 2882, 8281, has three interesting properties.</p>
      <ol>
        <li>The set is cyclic, in that the last two digits of each number is the first two digits of the next number (including the last number with the first).</li>
        <li>Each polygonal type: triangle (P<sub>3,127</sub>=8128), square (P<sub>4,91</sub>=8281), and pentagonal (P<sub>5,44</sub>=2882), is represented by a different number in the set.</li>
        <li>This is the only set of 4-digit numbers with this property.</li>
      </ol>
      <p>Find the sum of the only ordered set of six cyclic 4-digit numbers for which each polygonal type: triangle, square, pentagonal, hexagonal, heptagonal, and octagonal, is represented by a different number in the set.</p>
    </div>
    
    <table style="border-spacing: 10px;">
      <tr><td colspan="4"><b>Solve the problem</b></td></tr>
      <tr>
<!--           <td>N:</td><td><input id="n" name="n" value="3"/></td>-->
          <td><button onclick="solveAndOut('out2')">Solve</button></td>
          <td><div id="out2"></div></td>
      </tr>
    
    </table>

    <a href="Euler.html">Back</a>
  </body>
</html>